
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../l10n/">
      
      
        <link rel="next" href="../contribute/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.19">
    
    
      
        <title>Developing on Bedrock - Bedrock Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.eebd395e.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="deep-orange">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#managing-dependencies" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Bedrock Documentation" class="md-header__button md-logo" aria-label="Bedrock Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Bedrock Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Developing on Bedrock
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="deep-orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="deep-orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/mozilla/bedrock" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    mozilla/bedrock
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Bedrock Documentation" class="md-nav__button md-logo" aria-label="Bedrock Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Bedrock Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/mozilla/bedrock" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    mozilla/bedrock
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../install/" class="md-nav__link">
        Install
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../l10n/" class="md-nav__link">
        Localization
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Developing on Bedrock
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Developing on Bedrock
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#managing-dependencies" class="md-nav__link">
    Managing Dependencies
  </a>
  
    <nav class="md-nav" aria-label="Managing Dependencies">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#front-end-dependencies" class="md-nav__link">
    Front-end Dependencies
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#asset-management-and-bundling" class="md-nav__link">
    Asset Management and Bundling
  </a>
  
    <nav class="md-nav" aria-label="Asset Management and Bundling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#webpack-configuration" class="md-nav__link">
    Webpack Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asset-bundling" class="md-nav__link">
    Asset Bundling
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#writing-javascript" class="md-nav__link">
    Writing JavaScript
  </a>
  
    <nav class="md-nav" aria-label="Writing JavaScript">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#default-configuration" class="md-nav__link">
    Default Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#babel-configuration" class="md-nav__link">
    Babel Configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#writing-url-patterns" class="md-nav__link">
    Writing URL Patterns
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#finding-templates-by-url" class="md-nav__link">
    Finding Templates by URL
  </a>
  
    <nav class="md-nav" aria-label="Finding Templates by URL">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#general-structure" class="md-nav__link">
    General Structure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatsnew-and-firstrun" class="md-nav__link">
    Whatsnew and Firstrun
  </a>
  
    <nav class="md-nav" aria-label="Whatsnew and Firstrun">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#firefox-release" class="md-nav__link">
    Firefox release
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#firefox-nightly" class="md-nav__link">
    Firefox Nightly
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#firefox-developer" class="md-nav__link">
    Firefox Developer
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#release-notes" class="md-nav__link">
    Release Notes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optimizing-images" class="md-nav__link">
    Optimizing Images
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#embedding-images" class="md-nav__link">
    Embedding Images
  </a>
  
    <nav class="md-nav" aria-label="Embedding Images">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#primary-image-helpers" class="md-nav__link">
    Primary image helpers
  </a>
  
    <nav class="md-nav" aria-label="Primary image helpers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#static" class="md-nav__link">
    static()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resp_img" class="md-nav__link">
    resp_img()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#picture" class="md-nav__link">
    picture()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#which-image-helper-should-you-use" class="md-nav__link">
    Which image helper should you use?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secondary-image-helpers" class="md-nav__link">
    Secondary image helpers
  </a>
  
    <nav class="md-nav" aria-label="Secondary image helpers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#l10n_img" class="md-nav__link">
    l10n_img()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qrcode" class="md-nav__link">
    qrcode()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-large-assets" class="md-nav__link">
    Using Large Assets
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#writing-migrations" class="md-nav__link">
    Writing Migrations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#writing-views" class="md-nav__link">
    Writing Views
  </a>
  
    <nav class="md-nav" aria-label="Writing Views">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#variation-views" class="md-nav__link">
    Variation Views
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geo-template-view" class="md-nav__link">
    Geo Template View
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-geo-stuff" class="md-nav__link">
    Other Geo Stuff
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#coding-style" class="md-nav__link">
    Coding Style
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-coverage" class="md-nav__link">
    Test coverage
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-your-code-editor" class="md-nav__link">
    Configuring your Code Editor
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#working-with-protocol-design-system" class="md-nav__link">
    Working with Protocol Design System
  </a>
  
    <nav class="md-nav" aria-label="Working with Protocol Design System">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#styles-and-components" class="md-nav__link">
    Styles and Components
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#macros" class="md-nav__link">
    Macros
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#import-css-bundles" class="md-nav__link">
    Import CSS Bundles
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../contribute/" class="md-nav__link">
        How to Contribute
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../pipeline/" class="md-nav__link">
        Continuous Integration & Deployment
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../testing/" class="md-nav__link">
        Front-end testing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../redirects/" class="md-nav__link">
        Managing redirects
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../newsletters/" class="md-nav__link">
        Newsletters
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../contentful/" class="md-nav__link">
        Contentful CMS Integration
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../sitemap/" class="md-nav__link">
        Sitemaps
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../content-cards/" class="md-nav__link">
        Using External Content Card Data
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../banners/" class="md-nav__link">
        Banners
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../uitour/" class="md-nav__link">
        Mozilla.UITour
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../send-to-device/" class="md-nav__link">
        Send to Device widget
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../download-buttons/" class="md-nav__link">
        Firefox Download Buttons
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../mozilla-accounts/" class="md-nav__link">
        Mozilla account helpers
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../funnelcake/" class="md-nav__link">
        Funnel cakes and Partner Builds
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../abtest/" class="md-nav__link">
        A/B Testing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../vpn-subscriptions/" class="md-nav__link">
        Mozilla VPN Subscriptions
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_21" >
      
      
      
        <label class="md-nav__link" for="__nav_21" id="__nav_21_label" tabindex="0">
          Attribution
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_21_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_21">
          <span class="md-nav__icon md-icon"></span>
          Attribution
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../attribution/" class="md-nav__link">
        Attribution
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../attribution/0001-analytics/" class="md-nav__link">
        Mozorg Analytics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../attribution/0002-firefox-desktop/" class="md-nav__link">
        Firefox Desktop attribution
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../attribution/0003-firefox-mobile/" class="md-nav__link">
        Firefox Mobile attribution
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../attribution/0004-mozilla-accounts/" class="md-nav__link">
        Mozilla accounts attribution
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../attribution/0005-affiliate-marketing/" class="md-nav__link">
        Mozilla CJMS Affiliate attribution
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../attribution/0006-pocket-analytics/" class="md-nav__link">
        Pocket mode attribution
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_22" >
      
      
      
        <label class="md-nav__link" for="__nav_22" id="__nav_22_label" tabindex="0">
          Architectural Decision Records
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_22_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_22">
          <span class="md-nav__icon md-icon"></span>
          Architectural Decision Records
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../architectural-decisions/" class="md-nav__link">
        Architectural Decision Records
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/decisions/0001-record-architecture-decisions/" class="md-nav__link">
        1. Record architecture decisions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/decisions/0002-move-ci-cd-pipelines-to-gitlab/" class="md-nav__link">
        2. Move CI/CD Pipelines to Gitlab
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/decisions/0003-use-cloudflare-workers-and-convert-for-multi-variant-testing/" class="md-nav__link">
        3. Use Cloudflare Workers and Convert for multi-variant testing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/decisions/0004-use-fluent-for-localization/" class="md-nav__link">
        4. Use Fluent For Localization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/decisions/0005-use-a-single-docker-image-for-all-deployments/" class="md-nav__link">
        5. Use a Single Docker Image For All Deployments
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/decisions/0006-revise-tooling-for-python-dependency-management/" class="md-nav__link">
        6. Revise tooling for Python dependency management
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/decisions/0007-further-revise-tooling-for-python-dependency-management/" class="md-nav__link">
        7. Further revise tooling for Python dependency management
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/decisions/0008-move-demos-to-gcp/" class="md-nav__link">
        8. Move Demos To GCP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/decisions/0009-use-manage-contentful-migrations/" class="md-nav__link">
        9. Manage Contentful schema state via migrations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/decisions/0010-move-ci-cd-to-github-actions/" class="md-nav__link">
        10. Move CI to Github Actions for Unit and Integration tests
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/decisions/0011-use-statsd-for-metrics-collection/" class="md-nav__link">
        11. Use StatsD for metrics collection
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../browser-support/" class="md-nav__link">
        Browser Support
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#managing-dependencies" class="md-nav__link">
    Managing Dependencies
  </a>
  
    <nav class="md-nav" aria-label="Managing Dependencies">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#front-end-dependencies" class="md-nav__link">
    Front-end Dependencies
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#asset-management-and-bundling" class="md-nav__link">
    Asset Management and Bundling
  </a>
  
    <nav class="md-nav" aria-label="Asset Management and Bundling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#webpack-configuration" class="md-nav__link">
    Webpack Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asset-bundling" class="md-nav__link">
    Asset Bundling
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#writing-javascript" class="md-nav__link">
    Writing JavaScript
  </a>
  
    <nav class="md-nav" aria-label="Writing JavaScript">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#default-configuration" class="md-nav__link">
    Default Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#babel-configuration" class="md-nav__link">
    Babel Configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#writing-url-patterns" class="md-nav__link">
    Writing URL Patterns
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#finding-templates-by-url" class="md-nav__link">
    Finding Templates by URL
  </a>
  
    <nav class="md-nav" aria-label="Finding Templates by URL">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#general-structure" class="md-nav__link">
    General Structure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatsnew-and-firstrun" class="md-nav__link">
    Whatsnew and Firstrun
  </a>
  
    <nav class="md-nav" aria-label="Whatsnew and Firstrun">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#firefox-release" class="md-nav__link">
    Firefox release
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#firefox-nightly" class="md-nav__link">
    Firefox Nightly
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#firefox-developer" class="md-nav__link">
    Firefox Developer
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#release-notes" class="md-nav__link">
    Release Notes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optimizing-images" class="md-nav__link">
    Optimizing Images
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#embedding-images" class="md-nav__link">
    Embedding Images
  </a>
  
    <nav class="md-nav" aria-label="Embedding Images">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#primary-image-helpers" class="md-nav__link">
    Primary image helpers
  </a>
  
    <nav class="md-nav" aria-label="Primary image helpers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#static" class="md-nav__link">
    static()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resp_img" class="md-nav__link">
    resp_img()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#picture" class="md-nav__link">
    picture()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#which-image-helper-should-you-use" class="md-nav__link">
    Which image helper should you use?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secondary-image-helpers" class="md-nav__link">
    Secondary image helpers
  </a>
  
    <nav class="md-nav" aria-label="Secondary image helpers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#l10n_img" class="md-nav__link">
    l10n_img()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qrcode" class="md-nav__link">
    qrcode()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-large-assets" class="md-nav__link">
    Using Large Assets
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#writing-migrations" class="md-nav__link">
    Writing Migrations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#writing-views" class="md-nav__link">
    Writing Views
  </a>
  
    <nav class="md-nav" aria-label="Writing Views">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#variation-views" class="md-nav__link">
    Variation Views
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geo-template-view" class="md-nav__link">
    Geo Template View
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-geo-stuff" class="md-nav__link">
    Other Geo Stuff
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#coding-style" class="md-nav__link">
    Coding Style
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-coverage" class="md-nav__link">
    Test coverage
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-your-code-editor" class="md-nav__link">
    Configuring your Code Editor
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#working-with-protocol-design-system" class="md-nav__link">
    Working with Protocol Design System
  </a>
  
    <nav class="md-nav" aria-label="Working with Protocol Design System">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#styles-and-components" class="md-nav__link">
    Styles and Components
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#macros" class="md-nav__link">
    Macros
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#import-css-bundles" class="md-nav__link">
    Import CSS Bundles
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>Developing on Bedrock</h1>

<h2 id="managing-dependencies">Managing Dependencies<a class="headerlink" href="#managing-dependencies" title="Permanent link">&para;</a></h2>
<p>For Python we use <code>pip-compile</code> from
<a href="https://pypi.org/project/pip-tools/">pip-tools</a> to manage dependencies
expressed in our <a href="https://github.com/mozilla/bedrock/tree/main/requirements">requirements
files</a>.
<code>pip-compile</code> is wrapped up in Makefile commands, to ensure we use it
consistently.</p>
<p>If you add a new Python dependency (eg to <code>requirements/prod.in</code> or
<code>requirements/dev.in</code>) you can generate a pinned and hash-marked
addition to our requirements files just by running:</p>
<div class="highlight"><pre><span></span><code>make<span class="w"> </span>compile-requirements
</code></pre></div>
<p>and committing any changes that are made. Please re-build your docker
image and test it with <code>make build test</code> to be sure the dependency does
not cause a regression.</p>
<p>Similarly, if you <em>upgrade</em> a pinned dependency in an <code>*.in</code> file, run
<code>make compile-requirements</code> then rebuild, test and commit the results</p>
<p>To check for stale Python dependencies (basically <code>pip list -o</code> but in
the Docker container):</p>
<div class="highlight"><pre><span></span><code>make<span class="w"> </span>check-requirements
</code></pre></div>
<p>For Node packages we use
<a href="https://docs.npmjs.com/cli/v8/commands/npm-install">NPM</a>, which should
already be installed alongside <a href="https://nodejs.org/">Node.js</a>.</p>
<h3 id="front-end-dependencies">Front-end Dependencies<a class="headerlink" href="#front-end-dependencies" title="Permanent link">&para;</a></h3>
<p>Our team maintains a few dependencies that we serve on Bedrock's
front-end.</p>
<ul>
<li><a href="https://www.npmjs.com/package/@mozilla-protocol/core">\@mozilla-protocol/core</a>:
    Bedrock's primary design system</li>
<li><a href="https://www.npmjs.com/package/@mozmeao/cookie-helper">\@mozmeao/cookie-helper</a>:
    A complete cookies reader/writer framework</li>
<li><a href="https://github.com/mozmeao/dnt-helper">\@mozmeao/dnt-helper</a>: Do
    Not Track (DNT) helper</li>
<li><a href="https://www.npmjs.com/package/@mozmeao/trafficcop">\@mozmeao/trafficcop</a>:
    Used for A/B testing page variants</li>
</ul>
<p>Because they are all published on NPM, install the packages and keep
up-to-date with the latest version of each dependency by running an
<code>npm install</code>. For further documentation on installing NPM packages,
<a href="https://docs.npmjs.com/cli/v6/commands/npm-install">check out the official
documentation</a>.</p>
<h2 id="asset-management-and-bundling">Asset Management and Bundling<a class="headerlink" href="#asset-management-and-bundling" title="Permanent link">&para;</a></h2>
<p>Bedrock uses <a href="https://webpack.js.org/">Webpack</a> to manage front-end
asset processing and bundling. This includes processing and minifying
JavaScript and SCSS/CSS bundles, as well as managing static assets such
as images, fonts, and other common file types.</p>
<p>When developing on bedrock you can start Webpack by running <code>make run</code>
when using Docker, or <code>npm start</code> when running bedrock locally.</p>
<p>Once Webpack has finished compiling, a local development server will be
available at <a href="http://localhost:8000/">localhost:8000</a>. When Webpack
detects changes to a JS/SCSS file, it will automatically recompile the
bundle and then refresh any page running locally in the browser.</p>
<h3 id="webpack-configuration">Webpack Configuration<a class="headerlink" href="#webpack-configuration" title="Permanent link">&para;</a></h3>
<p>We have two main Webpack config files in the root directory:</p>
<p>The <code>webpack.static.config.js</code> file is responsible for copying static
assets, such as images and fonts, from the <code>/media/</code> directory over to
the <code>/assets/</code> directory. This is required so Django can serve them
correctly.</p>
<p>The <code>webpack.config.js</code> file is responsible for processing JS and SCSS
files in the <code>/media/</code> directory and compiling them into the <code>/assets/</code>
directory. This config file also starts a local development server and
watches for file changes.</p>
<p>We use two separate config files to keep responsibilities clearly
defined, and to make the configs both shorter and easier to follow.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Because of the large number of files used in bedrock, only JS and SCSS
files managed by <code>webpack.config.js</code> are watched for changes when in
development mode. This helps save on memory consumption. The implication
of this is that files handled by <code>webpack.static.config.js</code> are only
copied over when Webpack first runs. If you update an image for example,
then you will need to stop and restart Webpack to pick up the change.
This is not true for JS and SCSS files, which will be watched for change
automatically.</p>
</div>
<h3 id="asset-bundling">Asset Bundling<a class="headerlink" href="#asset-bundling" title="Permanent link">&para;</a></h3>
<p>Asset bundles for both JS and SCSS are defined in
<code>./media/static-bundles.json</code>. This is the file where you can define the
bundle names that will get used in page templates. For example, a CSS
bundle can be defined as:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&quot;css&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;files&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="s2">&quot;css/firefox/new/basic/download.scss&quot;</span>
<span class="w">        </span><span class="p">],</span>
<span class="w">        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;firefox_new_download&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">]</span>
</code></pre></div>
<p>Which can then be referenced in a page template using:</p>
<div class="highlight"><pre><span></span><code><span class="cp">{{</span> <span class="nv">css_bundle</span><span class="o">(</span><span class="s1">&#39;firefox_new_download&#39;</span><span class="o">)</span> <span class="cp">}}</span>
</code></pre></div>
<p>A JS bundle can be defied as:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&quot;js&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;files&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="s2">&quot;protocol/js/protocol-modal.js&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;js/firefox/new/basic/download.js&quot;</span>
<span class="w">        </span><span class="p">],</span>
<span class="w">        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;firefox_new_download&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">]</span>
</code></pre></div>
<p>Which can then be referenced in a page template using:</p>
<div class="highlight"><pre><span></span><code><span class="cp">{{</span> <span class="nv">js_bundle</span><span class="o">(</span><span class="s1">&#39;firefox_new_download&#39;</span><span class="o">)</span> <span class="cp">}}</span>
</code></pre></div>
<p>Once you define a bundle in <code>static-bundles.json</code>, the
<code>webpack.config.js</code> file will use these as entrypoints for compiling JS
and CSS and watching for changes.</p>
<h2 id="writing-javascript">Writing JavaScript<a class="headerlink" href="#writing-javascript" title="Permanent link">&para;</a></h2>
<p>Bedrock's Webpack configuration supports some different options for
writing JavaScript:</p>
<h3 id="default-configuration">Default Configuration<a class="headerlink" href="#default-configuration" title="Permanent link">&para;</a></h3>
<p>Write <code>example-script.js</code> using ES5 syntax and features. Webpack will
bundle the JS as-is, without any additional pre-processing.</p>
<h3 id="babel-configuration">Babel Configuration<a class="headerlink" href="#babel-configuration" title="Permanent link">&para;</a></h3>
<p>Write <code>example-script.es6.js</code> using ES2015+ syntax. Webpack will
transpile the code to ES5 using <a href="https://babeljs.io/">Babel</a>. This is
useful when you want to write modern syntax but still support older
browsers.</p>
<div class="admonition tip">
<p class="admonition-title">Important</p>
<p>Whilst Babel will transpile most modern JS syntax to ES5 when suitable
fallbacks exist, it won't automatically include custom polyfills for
everything since these can start to greatly increase bundle size. If you
want to use <code>Promise</code> or <code>async/await</code> functions for example, then you
will need to load polyfills for those. This can be done either at the
page level, or globally in <code>lib.js</code> if it's something that multiple
pages would benefit from. But please pick and choose wisely, and be
concious of performance.</p>
</div>
<p>For pages that are served to Firefox browsers only, such as <code>/whatsnew</code>,
it is also possible to write native ES2015+ syntax and serve that
directly in production. Here there is no need to include the <code>.es6.js</code>
file extension. Instead, you can simply use <code>.js</code> instead. The rules
that which files you can do this in are defined in our <a href="https://github.com/mozilla/bedrock/blob/main/.eslintrc.js">ESLint
config</a>.</p>
<h2 id="writing-url-patterns">Writing URL Patterns<a class="headerlink" href="#writing-url-patterns" title="Permanent link">&para;</a></h2>
<p>URL patterns should be the entire URL you desire, minus any prefixes
from URLs files importing this one, and including a trailing slash. You
should also give the URL a name so that other pages can reference it
instead of hardcoding the URL. Example:</p>
<div class="highlight"><pre><span></span><code><span class="n">path</span><span class="p">(</span><span class="s2">&quot;channel/&quot;</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;mozorg.channel&quot;</span><span class="p">)</span>
</code></pre></div>
<p>If you only want to render a template and don't need to do anything
else in a custom view, Bedrock comes with a handy shortcut to automate
all of this:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">bedrock.mozorg.util</span> <span class="kn">import</span> <span class="n">page</span>
<span class="n">page</span><span class="p">(</span><span class="s2">&quot;channel/&quot;</span><span class="p">,</span> <span class="s2">&quot;mozorg/channel.html&quot;</span><span class="p">)</span>
</code></pre></div>
<p>You don't need to create a view. It will serve up the specified
template at the given URL (the first parameter. see the <a href="https://docs.djangoproject.com/en/3.2/ref/urls/#django.urls.path">Django
docs</a>
for details). You can also pass template data as keyword arguments:</p>
<div class="highlight"><pre><span></span><code><span class="n">page</span><span class="p">(</span><span class="s2">&quot;channel/&quot;</span><span class="p">,</span> <span class="s2">&quot;mozorg/channel.html&quot;</span><span class="p">,</span>
     <span class="n">latest_version</span><span class="o">=</span><span class="n">product_details</span><span class="o">.</span><span class="n">firefox_versions</span><span class="p">[</span><span class="s2">&quot;LATEST_FIREFOX_VERSION&quot;</span><span class="p">])</span>
</code></pre></div>
<p>The variable <code>latest_version</code> will be available in the template.</p>
<h2 id="finding-templates-by-url">Finding Templates by URL<a class="headerlink" href="#finding-templates-by-url" title="Permanent link">&para;</a></h2>
<h3 id="general-structure">General Structure<a class="headerlink" href="#general-structure" title="Permanent link">&para;</a></h3>
<p>Bedrock follows the Django app structure and most templates are easy to
find by matching URL path segments to folders and files within the
correct app.</p>
<p>| URL:
  <code>https://www.mozilla.org/en-US/firefox/features/private-browsing/</code>
| Template path:
  <code>bedrock/bedrock/firefox/templates/firefox/features/private-browsing.html</code></p>
<p>To get from URL to template path:</p>
<ul>
<li>Ignore <code>https://www.mozilla.org</code> and the locale path segment
    <code>/en-US</code>. The next path segment is the app name <code>/firefox</code>.</li>
<li>From the root folder of bedrock, find the app's template folder at
    <code>bedrock/{app}/templates/{app}</code></li>
<li>Match remaining URL path segments (<code>/features/private-browsing</code>) to
    the template folder's structure (<code>/features/private-browsing.html</code>)</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>mozorg</code> is the app name for the home page and child pages related to
Mozilla Corporation (i.e. About, Contact, Diversity).</p>
</div>
<h3 id="whatsnew-and-firstrun">Whatsnew and Firstrun<a class="headerlink" href="#whatsnew-and-firstrun" title="Permanent link">&para;</a></h3>
<p>These pages are specific to Firefox browsers, and only appear when a
user updates or installs and runs a Firefox browser for the first time.
The URL and template depend on what Firefox browser and version are in
use.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There may be extra logic in the app's <code>views.py</code> file to change the
template based on locale or geographic location as well.</p>
</div>
<h4 id="firefox-release">Firefox release<a class="headerlink" href="#firefox-release" title="Permanent link">&para;</a></h4>
<p>Version number is digits only.</p>
<p>| Whatsnew URL: <a href="https://www.mozilla.org/en-US/firefox/99.0/whatsnew/">https://www.mozilla.org/en-US/firefox/99.0/whatsnew/</a>
| Template path:
  <a href="https://github.com/mozilla/bedrock/tree/main/bedrock/firefox/templates/firefox/whatsnew">https://github.com/mozilla/bedrock/tree/main/bedrock/firefox/templates/firefox/whatsnew</a></p>
<p>| Firstrun URL: <a href="https://www.mozilla.org/en-US/firefox/99.0/firstrun/">https://www.mozilla.org/en-US/firefox/99.0/firstrun/</a>
| Template path:
  <a href="https://github.com/mozilla/bedrock/blob/main/bedrock/firefox/templates/firefox/firstrun/firstrun.html">https://github.com/mozilla/bedrock/blob/main/bedrock/firefox/templates/firefox/firstrun/firstrun.html</a></p>
<h4 id="firefox-nightly">Firefox Nightly<a class="headerlink" href="#firefox-nightly" title="Permanent link">&para;</a></h4>
<p>Version number is digits and <strong>a1</strong>.</p>
<p>| Whatsnew URL: <a href="https://www.mozilla.org/en-US/firefox/99.0a1/whatsnew/">https://www.mozilla.org/en-US/firefox/99.0a1/whatsnew/</a>
| Template path:
  <a href="https://github.com/mozilla/bedrock/blob/main/bedrock/firefox/templates/firefox/nightly/whatsnew.html">https://github.com/mozilla/bedrock/blob/main/bedrock/firefox/templates/firefox/nightly/whatsnew.html</a></p>
<p>| Firstrun URL:
  <a href="https://www.mozilla.org/en-US/firefox/nightly/firstrun/">https://www.mozilla.org/en-US/firefox/nightly/firstrun/</a>
| Template path:
  <a href="https://github.com/mozilla/bedrock/tree/main/bedrock/firefox/templates/firefox/nightly">https://github.com/mozilla/bedrock/tree/main/bedrock/firefox/templates/firefox/nightly</a></p>
<h4 id="firefox-developer">Firefox Developer<a class="headerlink" href="#firefox-developer" title="Permanent link">&para;</a></h4>
<p>Version number is digits and <strong>a2</strong>.</p>
<p>| Whatsnew URL: <a href="https://www.mozilla.org/en-US/firefox/99.0a2/whatsnew/">https://www.mozilla.org/en-US/firefox/99.0a2/whatsnew/</a>
| Template path:
  <a href="https://github.com/mozilla/bedrock/blob/main/bedrock/firefox/templates/firefox/developer/whatsnew.html">https://github.com/mozilla/bedrock/blob/main/bedrock/firefox/templates/firefox/developer/whatsnew.html</a></p>
<p>| Firstrun URL: <a href="https://www.mozilla.org/en-US/firefox/99.0a2/firstrun/">https://www.mozilla.org/en-US/firefox/99.0a2/firstrun/</a>
| Template path:
  <a href="https://github.com/mozilla/bedrock/blob/main/bedrock/firefox/templates/firefox/developer/firstrun.html">https://github.com/mozilla/bedrock/blob/main/bedrock/firefox/templates/firefox/developer/firstrun.html</a></p>
<h3 id="release-notes">Release Notes<a class="headerlink" href="#release-notes" title="Permanent link">&para;</a></h3>
<p>Release note templates live here:
<a href="https://github.com/mozilla/bedrock/tree/main/bedrock/firefox/templates/firefox/releases">https://github.com/mozilla/bedrock/tree/main/bedrock/firefox/templates/firefox/releases</a></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Release note content is pulled in from an external data source.</p>
</div>
<ul>
<li>Firefox release:
    <a href="https://www.mozilla.org/en-US/firefox/99.0.1/releasenotes/">https://www.mozilla.org/en-US/firefox/99.0.1/releasenotes/</a></li>
<li>Firefox Developer and Beta:
    <a href="https://www.mozilla.org/en-US/firefox/100.0beta/releasenotes/">https://www.mozilla.org/en-US/firefox/100.0beta/releasenotes/</a></li>
<li>Firefox Nightly:
    <a href="https://www.mozilla.org/en-US/firefox/101.0a1/releasenotes/">https://www.mozilla.org/en-US/firefox/101.0a1/releasenotes/</a></li>
<li>Firefox Android:
    <a href="https://www.mozilla.org/en-US/firefox/android/99.0/releasenotes/">https://www.mozilla.org/en-US/firefox/android/99.0/releasenotes/</a></li>
<li>Firefox iOS:
    <a href="https://www.mozilla.org/en-US/firefox/ios/99.0/releasenotes/">https://www.mozilla.org/en-US/firefox/ios/99.0/releasenotes/</a></li>
</ul>
<h2 id="optimizing-images">Optimizing Images<a class="headerlink" href="#optimizing-images" title="Permanent link">&para;</a></h2>
<p>Images can take a long time to load and eat up a lot of bandwidth.
Always take care to optimize images before uploading them to the site.</p>
<p>The script <code>img.sh</code> can be used to optimize images locally on the
command line:</p>
<ol>
<li>Before you run it for the first time you will need to run
    <code>npm install</code> to install dependencies</li>
<li>Add the image files to git's staging area <code>git add *</code></li>
<li>Run the script <code>./bin/img.sh</code></li>
<li>The optimized files will not automatically be staged, so be sure to
    add them before commiting</li>
</ol>
<p>The script will:</p>
<p>-</p>
<div class="highlight"><pre><span></span><code>optimize JPG and PNG files using [tinypng](https://tinypng.com/) (

:   -   this step is optional since running compression on the same
        images over and over degrades them)
    -   you will be prompted to add a [TinyPNG API
        key](https://tinypng.com/developers)
</code></pre></div>
<ul>
<li>
<p>optimize SVG images locally with svgo</p>
</li>
<li>
<p>check that SVGs have a viewbox (needed for IE support)</p>
</li>
<li>
<p>check that images that end in <code>-high-res</code> have low res versions as
    well</p>
</li>
</ul>
<h2 id="embedding-images">Embedding Images<a class="headerlink" href="#embedding-images" title="Permanent link">&para;</a></h2>
<p>Images should be included on pages using one of the following helper
functions.</p>
<h3 id="primary-image-helpers">Primary image helpers<a class="headerlink" href="#primary-image-helpers" title="Permanent link">&para;</a></h3>
<p>The following image helpers support the most common features and use
cases you may encounter when coding pages:</p>
<h4 id="static">static()<a class="headerlink" href="#static" title="Permanent link">&para;</a></h4>
<p>For a simple image, the <code>static()</code> function is used to generate the
image URL. For example:</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;{{ static(&#39;img/firefox/new/firefox-wordmark-logo.svg&#39;) }}&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;Firefox&quot;</span><span class="p">&gt;</span>
</code></pre></div>
<p>will output an image:</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;/media/img/firefox/new/firefox-wordmark-logo.svg&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;Firefox&quot;</span><span class="p">&gt;</span>
</code></pre></div>
<h4 id="resp_img">resp_img()<a class="headerlink" href="#resp_img" title="Permanent link">&para;</a></h4>
<p>For <a href="https://developer.mozilla.org/docs/Learn/HTML/Multimedia_and_embedding/Responsive_images">responsive
images</a>,
where we want to specify multiple different image sizes and let the
browser select which is best to use.</p>
<p>The example below shows how to serve an appropriately sized, responsive
red panda image:</p>
<div class="highlight"><pre><span></span><code><span class="n">resp_img</span><span class="p">(</span>
    <span class="n">url</span><span class="o">=</span><span class="s2">&quot;img/panda-500.png&quot;</span><span class="p">,</span>
    <span class="n">srcset</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;img/panda-500.png&quot;</span><span class="p">:</span> <span class="s2">&quot;500w&quot;</span><span class="p">,</span>
        <span class="s2">&quot;img/panda-750.png&quot;</span><span class="p">:</span> <span class="s2">&quot;750w&quot;</span><span class="p">,</span>
        <span class="s2">&quot;img/panda-1000.png&quot;</span><span class="p">:</span> <span class="s2">&quot;1000w&quot;</span>
    <span class="p">},</span>
    <span class="n">sizes</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;(min-width: 1000px)&quot;</span><span class="p">:</span> <span class="s2">&quot;calc(50vw - 200px)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;calc(100vw - 50px)&quot;</span>
    <span class="p">}</span>
<span class="p">)</span>
</code></pre></div>
<p>This would output:</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;/media/img/panda-500.png&quot;</span>
     <span class="na">srcset</span><span class="o">=</span><span class="s">&quot;/media/img/panda-500.png 500w,/media/img/panda-750.png 750w,/media/img/panda-1000.png 1000w&quot;</span>
     <span class="na">sizes</span><span class="o">=</span><span class="s">&quot;(min-width: 1000px) calc(50vw - 200px),calc(100vw - 50px)&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">&gt;</span>&#39;
</code></pre></div>
<p>In the above example we specified the available image sources using the
<code>srcset</code> parameter. We then used <code>sizes</code> to say:</p>
<ul>
<li>When the viewport is greater than <code>1000px</code> wide, the panda image
    will take up roughly half of the page width.</li>
<li>When the viewport is less than <code>1000px</code> wide, the panda image will
    take up roughly full page width.</li>
</ul>
<p>The default image <code>src</code> is what we specified using the <code>url</code> param. This
is also what older browsers will fall back to using. Modern browsers
will instead pick the best source option from <code>srcset</code> (based on both
the estimated image size and screen resolution) to satisfy the condition
met in <code>sizes</code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The value <code>default</code> in the second <code>sizes</code> entry above should be used
when you want to omit a media query. This makes it possible to provide a
fallback size when no other media queries match.</p>
</div>
<p>Another example might be to serve a high resolution alternative for a
fixed size image:</p>
<div class="highlight"><pre><span></span><code><span class="n">resp_img</span><span class="p">(</span>
    <span class="n">url</span><span class="o">=</span><span class="s2">&quot;img/panda.png&quot;</span><span class="p">,</span>
    <span class="n">srcset</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;img/panda-high-res.png&quot;</span><span class="p">:</span> <span class="s2">&quot;2x&quot;</span>
    <span class="p">}</span>
<span class="p">)</span>
</code></pre></div>
<p>This would output:</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;/media/img/panda.png&quot;</span> <span class="na">srcset</span><span class="o">=</span><span class="s">&quot;/media/img/panda-high-res.png 2x&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">&gt;</span>
</code></pre></div>
<p>Here we don't need a <code>sizes</code> attribute, since the panda image is fixed
in size and small enough that it won't need to resize along with the
browser window. Instead the <code>srcset</code> image includes an alternate high
resolution source URL, along with a pixel density descriptor. This can
then be used to say:</p>
<ul>
<li>When a browser specifies a device pixel ratio of <code>2x</code> or greater,
    use <code>panda-high-res.png</code>.</li>
<li>When a browser specifies a device pixel ration of less than <code>2x</code>,
    use <code>panda.png</code>.</li>
</ul>
<p>The <code>resp_img()</code> helper also supports localized images by setting the
<code>'l10n'</code> parameter to <code>True</code>`:</p>
<div class="highlight"><pre><span></span><code><span class="n">resp_img</span><span class="p">(</span>
    <span class="n">url</span><span class="o">=</span><span class="s2">&quot;img/panda-500.png&quot;</span><span class="p">,</span>
    <span class="n">srcset</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;img/panda-500.png&quot;</span><span class="p">:</span> <span class="s2">&quot;500w&quot;</span><span class="p">,</span>
        <span class="s2">&quot;img/panda-750.png&quot;</span><span class="p">:</span> <span class="s2">&quot;750w&quot;</span><span class="p">,</span>
        <span class="s2">&quot;img/panda-1000.png&quot;</span><span class="p">:</span> <span class="s2">&quot;1000w&quot;</span>
    <span class="p">},</span>
    <span class="n">sizes</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;(min-width: 1000px)&quot;</span><span class="p">:</span> <span class="s2">&quot;calc(50vw - 200px)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;calc(100vw - 50px)&quot;</span>
    <span class="p">},</span>
    <span class="n">optional_attributes</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;l10n&quot;</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">}</span>
<span class="p">)</span>
</code></pre></div>
<p>This would output (assuming <code>de</code> was your locale):</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;/media/img/l10n/de/panda-500.png&quot;</span>
     <span class="na">srcset</span><span class="o">=</span><span class="s">&quot;/media/img/l10n/de/panda-500.png 500w,/media/img/l10n/de/panda-750.png 750w,/media/img/l10n/de/panda-1000.png 1000w&quot;</span>
     <span class="na">sizes</span><span class="o">=</span><span class="s">&quot;(min-width: 1000px) calc(50vw - 200px),calc(100vw - 50px)&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">&gt;</span>&#39;
</code></pre></div>
<p>Finally, you can also specify any other additional attributes you might
need using <code>optional_attributes</code>:</p>
<div class="highlight"><pre><span></span><code><span class="n">resp_img</span><span class="p">(</span>
    <span class="n">url</span><span class="o">=</span><span class="s2">&quot;img/panda-500.png&quot;</span><span class="p">,</span>
    <span class="n">srcset</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;img/panda-500.png&quot;</span><span class="p">:</span> <span class="s2">&quot;500w&quot;</span><span class="p">,</span>
        <span class="s2">&quot;img/panda-750.png&quot;</span><span class="p">:</span> <span class="s2">&quot;750w&quot;</span><span class="p">,</span>
        <span class="s2">&quot;img/panda-1000.png&quot;</span><span class="p">:</span> <span class="s2">&quot;1000w&quot;</span>
    <span class="p">},</span>
    <span class="n">sizes</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;(min-width: 1000px)&quot;</span><span class="p">:</span> <span class="s2">&quot;calc(50vw - 200px)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;calc(100vw - 50px)&quot;</span>
    <span class="p">},</span>
    <span class="n">optional_attributes</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;alt&quot;</span><span class="p">:</span> <span class="s2">&quot;Red Panda&quot;</span><span class="p">,</span>
        <span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;panda-hero&quot;</span><span class="p">,</span>
        <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="s2">&quot;500&quot;</span><span class="p">,</span>
        <span class="s2">&quot;l10n&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;loading&quot;</span><span class="p">:</span> <span class="s2">&quot;lazy&quot;</span><span class="p">,</span>
        <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="s2">&quot;500&quot;</span>
    <span class="p">}</span>
<span class="p">)</span>
</code></pre></div>
<h4 id="picture">picture()<a class="headerlink" href="#picture" title="Permanent link">&para;</a></h4>
<p>For <a href="https://developer.mozilla.org/docs/Learn/HTML/Multimedia_and_embedding/Responsive_images">responsive
images</a>,
where we want to serve different images, or image types, to suit
different display sizes.</p>
<p>The example below shows how to serve a different image for desktop and
mobile sizes screens:</p>
<div class="highlight"><pre><span></span><code><span class="n">picture</span><span class="p">(</span>
    <span class="n">url</span><span class="o">=</span><span class="s2">&quot;img/panda-mobile.png&quot;</span><span class="p">,</span>
    <span class="n">sources</span><span class="o">=</span><span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;media&quot;</span><span class="p">:</span> <span class="s2">&quot;(max-width: 799px)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;srcset&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;img/panda-mobile.png&quot;</span><span class="p">:</span> <span class="s2">&quot;default&quot;</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;media&quot;</span><span class="p">:</span> <span class="s2">&quot;(min-width: 800px)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;srcset&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;img/panda-desktop.png&quot;</span><span class="p">:</span> <span class="s2">&quot;default&quot;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">)</span>
</code></pre></div>
<p>This would output:</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">picture</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">source</span> <span class="na">media</span><span class="o">=</span><span class="s">&quot;(max-width: 799px)&quot;</span> <span class="na">srcset</span><span class="o">=</span><span class="s">&quot;/media/img/panda-mobile.png&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">source</span> <span class="na">media</span><span class="o">=</span><span class="s">&quot;(min-width: 800px)&quot;</span> <span class="na">srcset</span><span class="o">=</span><span class="s">&quot;/media/img/panda-desktop.png&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;/media/img/panda-mobile.png&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">picture</span><span class="p">&gt;</span>
</code></pre></div>
<p>In the above example, the default image <code>src</code> is what we specifed using
the <code>url</code> param. This is also what older browsers will fall back to
using. We then used the <code>sources</code> parameter to specify one or more
alternate image <code>&lt;source&gt;</code> elements, which modern browsers can take
advantage of. For each <code>&lt;source&gt;</code>, <code>media</code> lets us specify a media query
as a condition for when to load an image, and <code>srcset</code> lets us specify
one or more sizes for each image.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The value <code>default</code> in the <code>srcset</code> entry above should be used when you
want to omit a descriptor. In this example we only have one entry in
<code>srcset</code> (meaning it will be chosen immediately should the media query
be satisfied), hence we omit a descriptor value.</p>
</div>
<p>A more complex example might be when we want to load responsively sized,
animated gifs, but also offer still images for users who set
<code>(prefers-reduced-motion: reduce)</code>:</p>
<div class="highlight"><pre><span></span><code><span class="n">picture</span><span class="p">(</span>
    <span class="n">url</span><span class="o">=</span><span class="s2">&quot;img/dancing-panda-500.gif&quot;</span><span class="p">,</span>
    <span class="n">sources</span><span class="o">=</span><span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;media&quot;</span><span class="p">:</span> <span class="s2">&quot;(prefers-reduced-motion: reduce)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;srcset&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;img/sleeping-panda-500.png&quot;</span><span class="p">:</span> <span class="s2">&quot;500w&quot;</span><span class="p">,</span>
                <span class="s2">&quot;img/sleepinng-panda-750.png&quot;</span><span class="p">:</span> <span class="s2">&quot;750w&quot;</span><span class="p">,</span>
                <span class="s2">&quot;img/sleeping-panda-1000.png&quot;</span><span class="p">:</span> <span class="s2">&quot;1000w&quot;</span>
            <span class="p">},</span>
            <span class="s2">&quot;sizes&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;(min-width: 1000px)&quot;</span><span class="p">:</span> <span class="s2">&quot;calc(50vw - 200px)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;calc(100vw - 50px)&quot;</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;media&quot;</span><span class="p">:</span> <span class="s2">&quot;(prefers-reduced-motion: no-preference)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;srcset&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;img/dancing-panda-500.gif&quot;</span><span class="p">:</span> <span class="s2">&quot;500w&quot;</span><span class="p">,</span>
                <span class="s2">&quot;img/dancing-panda-750.gif&quot;</span><span class="p">:</span> <span class="s2">&quot;750w&quot;</span><span class="p">,</span>
                <span class="s2">&quot;img/dancing-panda-1000.gif&quot;</span><span class="p">:</span> <span class="s2">&quot;1000w&quot;</span>
            <span class="p">},</span>
            <span class="s2">&quot;sizes&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;(min-width: 1000px)&quot;</span><span class="p">:</span> <span class="s2">&quot;calc(50vw - 200px)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;calc(100vw - 50px)&quot;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">)</span>
</code></pre></div>
<p>This would output:</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">picture</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">source</span> <span class="na">media</span><span class="o">=</span><span class="s">&quot;(prefers-reduced-motion: reduce)&quot;</span>
            <span class="na">srcset</span><span class="o">=</span><span class="s">&quot;/media/img/sleeping-panda-500.png 500w,/media/img/sleeping-panda-750.png 750w,/media/img/sleeping-panda-1000.png 1000w&quot;</span>
            <span class="na">sizes</span><span class="o">=</span><span class="s">&quot;(min-width: 1000px) calc(50vw - 200px),calc(100vw - 50px)&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">source</span> <span class="na">media</span><span class="o">=</span><span class="s">&quot;(prefers-reduced-motion: no-preference)&quot;</span>
            <span class="na">srcset</span><span class="o">=</span><span class="s">&quot;/media/img/dancing-panda-500.gif 500w,/media/img/dancing-panda-750.gif 750w,/media/img/dancing-panda-1000.gif 1000w&quot;</span>
            <span class="na">sizes</span><span class="o">=</span><span class="s">&quot;(min-width: 1000px) calc(50vw - 200px),calc(100vw - 50px)&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;/media/img/dancing-panda-500.gif&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">picture</span><span class="p">&gt;</span>
</code></pre></div>
<p>In the above example we would default to loading animated gifs, but if a
user agent specified <code>(prefers-reduced-motion: reduce)</code> then the browser
would load static png files instead. Multiple image sizes are also
supported for each <code>&lt;source&gt;</code> using <code>srcset</code> and <code>sizes</code>.</p>
<p>Another type of use case might be to serve different image formats, so
capable browsers can take advantage of more efficient encoding:</p>
<div class="highlight"><pre><span></span><code><span class="n">picture</span><span class="p">(</span>
    <span class="n">url</span><span class="o">=</span><span class="s2">&quot;img/red-panda.png&quot;</span><span class="p">,</span>
    <span class="n">sources</span><span class="o">=</span><span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;image/webp&quot;</span><span class="p">,</span>
            <span class="s2">&quot;srcset&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;img/red-panda.webp&quot;</span><span class="p">:</span> <span class="s2">&quot;default&quot;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">)</span>
</code></pre></div>
<p>This would output:</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">picture</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">source</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;image/webp&quot;</span> <span class="na">srcset</span><span class="o">=</span><span class="s">&quot;/media/img/red-panda.webp&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;/media/img/red-panda.png&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">picture</span><span class="p">&gt;</span>
</code></pre></div>
<p>In the above example we use <code>sources</code> to specify an alternate image with
a <code>type</code> attribute of <code>image/webp</code>. This lets browsers that support WebP
to download <code>red-panda.webp</code>, whilst older browsers would download
<code>red-panda.png</code>.</p>
<p>Like <code>resp_img()</code>, the <code>picture()</code> helper also supports L10n images and
other useful attributes via the <code>optional_attributes</code> parameter:</p>
<div class="highlight"><pre><span></span><code><span class="n">picture</span><span class="p">(</span>
    <span class="n">url</span><span class="o">=</span><span class="s2">&quot;img/panda-mobile.png&quot;</span><span class="p">,</span>
    <span class="n">sources</span><span class="o">=</span><span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;media&quot;</span><span class="p">:</span> <span class="s2">&quot;(max-width: 799px)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;srcset&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;img/panda-mobile.png&quot;</span><span class="p">:</span> <span class="s2">&quot;default&quot;</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;media&quot;</span><span class="p">:</span> <span class="s2">&quot;(min-width: 800px)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;srcset&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;img/panda-desktop.png&quot;</span><span class="p">:</span> <span class="s2">&quot;default&quot;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="n">optional_attributes</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;alt&quot;</span><span class="p">:</span> <span class="s2">&quot;Red Panda&quot;</span><span class="p">,</span>
        <span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;panda-hero&quot;</span><span class="p">,</span>
        <span class="s2">&quot;l10n&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;loading&quot;</span><span class="p">:</span> <span class="s2">&quot;lazy&quot;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>
</code></pre></div>
<h3 id="which-image-helper-should-you-use">Which image helper should you use?<a class="headerlink" href="#which-image-helper-should-you-use" title="Permanent link">&para;</a></h3>
<p>This is a good question. The answer depends entirely on the image in
question. A good rule of thumb is as follows:</p>
<p>-</p>
<div class="highlight"><pre><span></span><code>Is the image a vector format (e.g. `.svg`)?

:   -   If yes, then for most cases you can simply use `static()`.
</code></pre></div>
<p>-</p>
<div class="highlight"><pre><span></span><code>Is the image a raster format (e.g. `.png` or `.jpg`)?

:   -   Is the same image displayed on both large and small
        viewports? Does the image need to scale as the browser
        resizes? If yes to both, then use `resp_img()` with both
        `srcset` and `sizes`.
    -   Is the image fixed in size (non-responsive)? Do you need to
        serve a high resolution version? If yes to both, then use
        `resp_img()` with just `srcset`.
</code></pre></div>
<ul>
<li>
<p>Does the source image need to change depending on a media query (e.g
    serve a different image on both desktop and mobile)? If yes, then
    use <code>picture()</code> with <code>media</code> and <code>srcset</code>.</p>
</li>
<li>
<p>Is the image format only supported in certain browsers? Do you need
    to provide a fallback? If yes to both, then use <code>picture()</code> with
    <code>type</code> and <code>srcset</code>.</p>
</li>
</ul>
<h3 id="secondary-image-helpers">Secondary image helpers<a class="headerlink" href="#secondary-image-helpers" title="Permanent link">&para;</a></h3>
<p>The following image helpers are less commonly used, but exist to support
more specific use cases. Some are also encapsulated as features inside
inside of primary helpers, such as <code>l1n_img()</code>.</p>
<h4 id="l10n_img">l10n_img()<a class="headerlink" href="#l10n_img" title="Permanent link">&para;</a></h4>
<p>Images that have translatable text can be handled with <code>l10n_img()</code>:</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;{{ l10n_img(&#39;firefox/os/have-it-all/messages.jpg&#39;) }}&quot;</span><span class="p">&gt;</span>
</code></pre></div>
<p>The images referenced by <code>l10n_img()</code> must exist in <code>media/img/l10n/</code>,
so for above example, the images could include
<code>media/img/l10n/en-US/firefox/os/have-it-all/messages.jpg</code> and
<code>media/img/l10n/es-ES/firefox/os/have-it-all/messages.jpg</code>.</p>
<h4 id="qrcode">qrcode()<a class="headerlink" href="#qrcode" title="Permanent link">&para;</a></h4>
<p>This is a helper function that will output SVG data for a QR Code at the
spot in the template where it is called. It caches the results to the
<code>data/qrcode_cache</code> directory, so it only generates the SVG data one
time per data and box_size combination.</p>
<div class="highlight"><pre><span></span><code><span class="n">qrcode</span><span class="p">(</span><span class="s2">&quot;https://accounts.firefox.com&quot;</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
</code></pre></div>
<p>The first argument is the data you'd like to encode in the QR Code
(usually a URL), and the second is the "box size". It's a parameter
that tells the generator how large to set the height and width
parameters on the XML SVG tag, the units of which are "mm". This can
be overriden with CSS so you may not need to use it at all. The
<code>box_size</code> parameter is optional.</p>
<h2 id="using-large-assets">Using Large Assets<a class="headerlink" href="#using-large-assets" title="Permanent link">&para;</a></h2>
<p>We don't want to (and if large enough GitHub won't let us) commit
large files to the bedrock repo. Files such as large PDFs or
very-high-res JPG files (e.g. leadership team photos), or videos are not
well-tracked in git and will make every checkout after they're added
slower and this diffs less useful. So we have another domain at which we
upload these files: assets.mozilla.net</p>
<p>This domain is simply an AWS S3 bucket with a CloudFront
<abbr title="Content Delivery Network">CDN</abbr> in front of it. It is highly available and fast. We've made adding files to this
domain very simple using <a href="https://git-lfs.github.com/">git-lfs</a>. You
simply install git-lfs, clone our <a href="https://github.com/mozmeao/assets.mozilla.net">assets.mozilla.net
repo</a>, and then add and
commit files under the <code>assets</code> directory there as usual. Open a pull
request, and once it's merged it will be automatically uploaded to the
S3 bucket and be available on the domain.</p>
<p>For example, if you add a file to the repo under
<code>assets/pdf/the-dude-abides.pdf</code>, it will be available as
<a href="https://assets.mozilla.net/pdf/the-dude-abides.pdf">https://assets.mozilla.net/pdf/the-dude-abides.pdf</a>. Once that is done
you can link to that URL from bedrock as you would any other URL.</p>
<h2 id="writing-migrations">Writing Migrations<a class="headerlink" href="#writing-migrations" title="Permanent link">&para;</a></h2>
<p>Bedrock uses Django's built-in Migrations framework for its database
migrations, and has no custom database routing, etc. So, no big
surprises here -- write things as you regularly would.</p>
<p><em>However</em>, as with any complex system, care needs to be taken with
schema changes that drop or rename database columns. Due to the way the
rollout process works (ask for details directly from the team), an
absent column can cause some of the rollout to enter a crashloop.</p>
<p>To avoid this, split your changes across releases, such as below.</p>
<p>For column renames:</p>
<ul>
<li>Release 1: Add your new column</li>
<li>Release 2: Amend the codebase to use it instead of the old column</li>
<li>Release 3: Clean up - drop the old, deprecated column, which should
    not be referenced in code at this point.</li>
</ul>
<p>For column drops:</p>
<ul>
<li>Release 1: Update all code that uses the relevant column, so that
    nothing interacts with it any more.</li>
<li>Release 2: Clean up - drop the old, deprecated column.</li>
</ul>
<p>With both paths, check for any custom schema or data migrations that
might reference the deprecated column.</p>
<h2 id="writing-views">Writing Views<a class="headerlink" href="#writing-views" title="Permanent link">&para;</a></h2>
<p>You should rarely need to write a view for mozilla.org. Most pages are
static and you should use the <code>page</code> function documented above.</p>
<p>If you need to write a view and the page is translated or translatable
then it should use the <code>l10n_utils.render()</code> function to render the
template.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">lib</span> <span class="kn">import</span> <span class="n">l10n_utils</span>

<span class="kn">from</span> <span class="nn">django.views.decorators.http</span> <span class="kn">import</span> <span class="n">require_safe</span>


<span class="nd">@require_safe</span>
<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1"># do your fancy things</span>
    <span class="n">ctx</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;template_variable&quot;</span><span class="p">:</span> <span class="s2">&quot;awesome data&quot;</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">l10n_utils</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;app/template.html&quot;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span>
</code></pre></div>
<p>Make sure to namespace your templates by putting them in a directory
named after your app, so instead of templates/template.html they would
be in templates/blog/template.html if <code>blog</code> was the name of your app.</p>
<p>The <code>require_safe</code> ensures that only <code>GET</code> or <code>HEAD</code> requests will make
it through to your view.</p>
<p>If you prefer to use Django's Generic View classes we have a convenient
helper for that. You can use it either to create a custom view class of
your own, or use it directly in a <code>urls.py</code> file.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># app/views.py</span>
<span class="kn">from</span> <span class="nn">lib.l10n_utils</span> <span class="kn">import</span> <span class="n">L10nTemplateView</span>

<span class="k">class</span> <span class="nc">FirefoxRoxView</span><span class="p">(</span><span class="n">L10nTemplateView</span><span class="p">):</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s2">&quot;app/firefox-rox.html&quot;</span>

<span class="c1"># app/urls.py</span>
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># from views.py</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">&quot;firefox/rox/&quot;</span><span class="p">,</span> <span class="n">FirefoxRoxView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()),</span>
    <span class="c1"># directly</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">&quot;firefox/sox/&quot;</span><span class="p">,</span> <span class="n">L10nTemplateView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="n">template_name</span><span class="o">=</span><span class="s2">&quot;app/firefox-sox.html&quot;</span><span class="p">)),</span>
<span class="p">]</span>
</code></pre></div>
<p>The <code>L10nTemplateView</code> functionality is mostly in a template mixin
called <code>LangFilesMixin</code> which you can use with other generic Django view
classes if you need one other than <code>TemplateView</code>. The
<code>L10nTemplateView</code> already ensures that only <code>GET</code> or <code>HEAD</code> requests
will be served.</p>
<h3 id="variation-views">Variation Views<a class="headerlink" href="#variation-views" title="Permanent link">&para;</a></h3>
<p>We have a generic view that allows you to easily create and use a/b
testing templates. If you'd like to have either separate templates or
just a template context variable for switching, this will help you out.
For example.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># urls.py</span>

<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>

<span class="kn">from</span> <span class="nn">bedrock.utils.views</span> <span class="kn">import</span> <span class="n">VariationTemplateView</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">&quot;testing/&quot;</span><span class="p">,</span>
         <span class="n">VariationTemplateView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="n">template_name</span><span class="o">=</span><span class="s2">&quot;testing.html&quot;</span><span class="p">,</span>
                                       <span class="n">template_context_variations</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">]),</span>
         <span class="n">name</span><span class="o">=</span><span class="s2">&quot;testing&quot;</span><span class="p">),</span>
<span class="p">]</span>
</code></pre></div>
<p>This will give you a context variable called <code>variation</code> that will
either be an empty string if no param is set, or <code>a</code> if <code>?v=a</code> is in the
URL, or <code>b</code> if <code>?v=b</code> is in the URL. No other options will be valid for
the <code>v</code> query parameter and <code>variation</code> will be empty if any other value
is passed in for <code>v</code> via the URL. So in your template code you'd simply
do the following:</p>
<div class="highlight"><pre><span></span><code><span class="cp">{%</span> <span class="k">if</span> <span class="nv">variation</span> <span class="o">==</span> <span class="s1">&#39;b&#39;</span> <span class="cp">%}</span><span class="x">&lt;p&gt;This is the B variation of our test. Enjoy!&lt;/p&gt;</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
</code></pre></div>
<p>If you'd rather have a fully separate template for your test, you can
use the <code>template_name_variations</code> argument to the view instead of
<code>template_context_variations</code>.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># urls.py</span>

<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>

<span class="kn">from</span> <span class="nn">bedrock.utils.views</span> <span class="kn">import</span> <span class="n">VariationTemplateView</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">&quot;testing/&quot;</span><span class="p">,</span>
         <span class="n">VariationTemplateView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="n">template_name</span><span class="o">=</span><span class="s2">&quot;testing.html&quot;</span><span class="p">,</span>
                                       <span class="n">template_name_variations</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">]),</span>
         <span class="n">name</span><span class="o">=</span><span class="s2">&quot;testing&quot;</span><span class="p">),</span>
<span class="p">]</span>
</code></pre></div>
<p>This will not provide any extra template context variables, but will
instead look for alternate template names. If the URL is <code>testing/?v=1</code>,
it will use a template named <code>testing-1.html</code>, if <code>v=2</code> it will use
<code>testing-2.html</code>, and for everything else it will use the default. It
simply puts a dash and the variation value between the template file
name and file extension.</p>
<p>It is theoretically possible to use the template name and template
context versions of this view together, but that would be an odd
situation and potentially inappropriate for this utility.</p>
<p>You can also limit your variations to certain locales. By default the
variations will work for any localization of the page, but if you supply
a list of locales to the <code>variation_locales</code> argument to the view then
it will only set the variation context variable or alter the template
name (depending on the options explained above) when requested at one of
said locales. For example, the template name example above could be
modified to only work for English or German like so</p>
<div class="highlight"><pre><span></span><code><span class="c1"># urls.py</span>

<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>

<span class="kn">from</span> <span class="nn">bedrock.utils.views</span> <span class="kn">import</span> <span class="n">VariationTemplateView</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">&quot;testing/&quot;</span><span class="p">,</span>
         <span class="n">VariationTemplateView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="n">template_name</span><span class="o">=</span><span class="s2">&quot;testing.html&quot;</span><span class="p">,</span>
                                       <span class="n">template_name_variations</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">],</span>
                                       <span class="n">variation_locales</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;en-US&quot;</span><span class="p">,</span> <span class="s2">&quot;de&quot;</span><span class="p">]),</span>
         <span class="n">name</span><span class="o">=</span><span class="s2">&quot;testing&quot;</span><span class="p">),</span>
<span class="p">]</span>
</code></pre></div>
<p>Any request to the page in for example French would not use the
alternate template even if a valid variation were given in the URL.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you'd like to add this functionality to an existing Class-Based
View, there is a mixin that implements this pattern that should work
with most views: <code>bedrock.utils.views.VariationMixin</code>.</p>
</div>
<h3 id="geo-template-view">Geo Template View<a class="headerlink" href="#geo-template-view" title="Permanent link">&para;</a></h3>
<p>Now that we have our <abbr title="Content Delivery Network">CDN</abbr> configured properly, we can also just swap out templates
per request country. This is very similar to the above, but it will
simply use the proper template for the country from which the request
originated.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">bedrock.base.views</span> <span class="kn">import</span> <span class="n">GeoTemplateView</span>

<span class="k">class</span> <span class="nc">CanadaIsSpecialView</span><span class="p">(</span><span class="n">GeoTemplateView</span><span class="p">):</span>
    <span class="n">geo_template_names</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;CA&quot;</span><span class="p">:</span> <span class="s2">&quot;mozorg/canada-is-special.html&quot;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s2">&quot;mozorg/everywhere-else-is-also-good.html&quot;</span>
</code></pre></div>
<p>For testing purposes while you're developing or on any deployment that
is not accessed via the production domain (<a href="http://www.mozilla.org">www.mozilla.org</a>) you can
append your URL with a <code>geo</code> query param (e.g. <code>/firefox/?geo=DE</code>) and
that will take precedence over the country from the request header.</p>
<h3 id="other-geo-stuff">Other Geo Stuff<a class="headerlink" href="#other-geo-stuff" title="Permanent link">&para;</a></h3>
<p>There are a couple of other tools at your disposal if you need to change
things depending on the location of the user. You can use the
<code>bedrock.base.geo.get_country_from_request</code> function in a view and it
will return the country code for the request (either from the
<abbr title="Content Delivery Network">CDN</abbr> or the query param, just like above).</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">bedrock.base.geo</span> <span class="kn">import</span> <span class="n">get_country_from_request</span>

<span class="k">def</span> <span class="nf">dude_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">country</span> <span class="o">=</span> <span class="n">get_country_from_request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">country</span> <span class="o">==</span> <span class="s2">&quot;US&quot;</span><span class="p">:</span>
        <span class="c1"># do a thing for the US</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># do the default thing</span>
</code></pre></div>
<p>The other convenience available is that the country code, either from
the <abbr title="Content Delivery Network">CDN</abbr> or the query param, is avilable in any template in the <code>country_code</code>
variable. This allows you to change anything about how the template
renders based on the location of the user.</p>
<div class="highlight"><pre><span></span><code><span class="cp">{%</span> <span class="k">if</span> <span class="nv">country_code</span> <span class="o">==</span> <span class="s2">&quot;US&quot;</span> <span class="cp">%}</span>
<span class="x">    &lt;h1&gt;GO MURICA!&lt;/h1&gt;</span>
<span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
<span class="x">    &lt;h1&gt;Yay World!&lt;/h1&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
</code></pre></div>
<p>Reference:</p>
<ul>
<li>Officially assigned list of <a href="https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2#Officially_assigned_code_elements">ISO country
    codes</a>.</li>
</ul>
<h2 id="coding-style">Coding Style<a class="headerlink" href="#coding-style" title="Permanent link">&para;</a></h2>
<p>Bedrock uses the following open source tools to follow coding styles and
conventions, as well as applying automatic code formatting:</p>
<ul>
<li><a href="https://beta.ruff.rs/docs/">ruff</a> for Python style, code quality
    rules, and import ordering.</li>
<li><a href="https://black.readthedocs.io/">black</a> for Python code formatting.</li>
<li><a href="https://prettier.io/">Prettier</a> for JavaScript code formatting.</li>
<li><a href="https://eslint.org/">ESLint</a> for JavaScript code quality rules.</li>
<li><a href="https://stylelint.io/">Stylelint</a> for Sass/CSS style and code
    quality rules.</li>
</ul>
<p>For front-end HTML &amp; CSS conventions, bedrock uses Mozilla's Protocol
design system for building components. You can read the <a href="https://protocol.mozilla.org/">Protocol
documentation site</a> for more information.</p>
<p>Mozilla also has some more general coding styleguides available,
although some of these are now rather outdated:</p>
<ul>
<li><a href="http://mozweb.readthedocs.org/en/latest/reference/python-style.html">Mozilla Python Style
    Guide</a></li>
<li><a href="http://mozweb.readthedocs.org/en/latest/reference/html-style.html">Mozilla HTML Style
    Guide</a></li>
<li><a href="http://mozweb.readthedocs.org/en/latest/reference/js-style.html">Mozilla JS Style
    Guide</a></li>
<li><a href="http://mozweb.readthedocs.org/en/latest/reference/css-style.html">Mozilla CSS Style
    Guide</a></li>
</ul>
<h2 id="test-coverage">Test coverage<a class="headerlink" href="#test-coverage" title="Permanent link">&para;</a></h2>
<p>When the Python tests are run, a coverage report is generated, showing
which lines of the codebase have tests that execute them, and which do
not. You can view this report in your browser at
<code>file:///path/to/your/checkout/of/bedrock/python_coverage/index.html</code>.</p>
<p>When adding code, please aim to provide solid test coverage, using the
coverage report as a guide. This doesn't necessarily mean every single
line needs a test, and 100% coverage doesn't mean 0% defects.</p>
<h2 id="configuring-your-code-editor">Configuring your Code Editor<a class="headerlink" href="#configuring-your-code-editor" title="Permanent link">&para;</a></h2>
<p>Bedrock includes an <code>.editorconfig</code> file in the root directory that you
can use with your code editor to help maintain consistent coding styles.
Please see <a href="http://editorconfig.org/">editorconfig.org</a>. for a list of
supported editors and available plugins.</p>
<h2 id="working-with-protocol-design-system">Working with Protocol Design System<a class="headerlink" href="#working-with-protocol-design-system" title="Permanent link">&para;</a></h2>
<p>Bedrock uses the <a href="https://protocol.mozilla.org/">Protocol Design System</a>
to quickly produce consistent, stable components. There are different
methods -- depending on the component -- to import a Protocol
component into our codebase.</p>
<p>One method involves two steps:</p>
<ol>
<li>Adding the <a href="#styles-and-components">correct markup</a> or importing the
    <a href="#macros">appropriate macro</a> to the page's HTML file.</li>
<li>Importing the necessary Protocol styles to a page's SCSS file.</li>
</ol>
<p>The other method is to <a href="#import-css-bundles">import CSS bundles</a> onto
the HTML file. However, this only works for certain components, which
are listed below in the respective section.</p>
<h3 id="styles-and-components">Styles and Components<a class="headerlink" href="#styles-and-components" title="Permanent link">&para;</a></h3>
<p>The base templates in Bedrock have global styles from Protocol that
apply to every page. When we need to extend these styles on a
page-specific basis, we set up Protocol in a page-specific SCSS file.</p>
<p>For example, on a Firefox product page, we might want to use Firefox
logos or wordmarks that do not exist on every page.</p>
<p>To do this, we add Protocol <code>mzp-</code> classes to the HTML:</p>
<div class="highlight"><pre><span></span><code>// bedrock/bedrock/firefox/templates/firefox/{specific-page}.html

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mzp-c-wordmark mzp-t-wordmark-md mzp-t-product-firefox&quot;</span><span class="p">&gt;</span>
    Firefox Browser
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></div>
<p>Then we need to include those Protocol styles in the page's SCSS file:</p>
<div class="highlight"><pre><span></span><code><span class="c">/* bedrock/media/css/firefox/{specific-page}.scss */</span>

<span class="c">/* if we need to use protocol images, we need to set the $image-path variable */</span>
<span class="o">$</span><span class="nt">image-path</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;/media/protocol/img&#39;</span><span class="o">;</span>
<span class="c">/* mozilla is the default theme, so if we want a different one, we need to set the $brand-theme variable */</span>
<span class="o">$</span><span class="nt">brand-theme</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;firefox&#39;</span><span class="o">;</span>

<span class="c">/* the lib import is always essential: it provides access to tokens, functions, mixins, and theming */</span>
<span class="p">@</span><span class="k">import</span><span class="w"> </span><span class="s1">&#39;~@mozilla-protocol/core/protocol/css/includes/lib&#39;</span><span class="p">;</span>
<span class="c">/* then you add whatever specific protocol styling you need */</span>
<span class="p">@</span><span class="k">import</span><span class="w"> </span><span class="s1">&#39;~@mozilla-protocol/core/protocol/css/components/logos/wordmark&#39;</span><span class="p">;</span>
<span class="p">@</span><span class="k">import</span><span class="w"> </span><span class="s1">&#39;~@mozilla-protocol/core/protocol/css/components/logos/wordmark-product-firefox&#39;</span><span class="p">;</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you create a new SCSS file for a page, you will have to include it in
that page's CSS bundle by updating
<a href="#asset-bundling">static-bundles.json</a> file.</p>
</div>
<h3 id="macros">Macros<a class="headerlink" href="#macros" title="Permanent link">&para;</a></h3>
<p>The team has created several <a href="https://jinja.palletsprojects.com/en/3.1.x/templates/?=macros#macros">Jinja
macros</a>
out of Protocol components to simplify the usage of components housing
larger blocks of code (i.e. Billboard). The code housing the custom
macros can be found in our <a href="https://github.com/mozilla/bedrock/blob/main/bedrock/base/templates/macros-protocol.html">protocol macros
file</a>.
These Jinja macros include parameters that are simple to define and
customize based on how the component should look like on a given page.</p>
<p>To use these macros in files, we simply import a macro to the page's
HTML code and call it with the desired arguments, instead of manually
adding Protocol markup. We can import multiple macros in a
comma-separated fashion, ending the import with <code>with context</code>:</p>
<div class="highlight"><pre><span></span><code>// bedrock/bedrock/firefox/templates/firefox/{specific-page}.html

{% from &quot;macros-protocol.html&quot; import billboard with context %}

{{ billboard(
    title=&#39;This is Firefox.&#39;,
    ga_title=&#39;This is Firefox&#39;,
    desc=&#39;Firefox is an awesome web browser.&#39;,
    link_cta=&#39;Click here to install&#39;,
    link_url=url(&#39;firefox.new&#39;)
  )}}
</code></pre></div>
<p>Because not all component styles are global, we still have to import the
page-specific Protocol styles in SCSS:</p>
<div class="highlight"><pre><span></span><code><span class="c">/* bedrock/media/css/firefox/{specific-page}.scss */</span>

<span class="o">$</span><span class="nt">brand-theme</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;firefox&#39;</span><span class="o">;</span>

<span class="p">@</span><span class="k">import</span><span class="w"> </span><span class="s1">&#39;~@mozilla-protocol/core/protocol/css/includes/lib&#39;</span><span class="p">;</span>
<span class="p">@</span><span class="k">import</span><span class="w"> </span><span class="s1">&#39;~@mozilla-protocol/core/protocol/css/components/billboard&#39;</span><span class="p">;</span>
</code></pre></div>
<h3 id="import-css-bundles">Import CSS Bundles<a class="headerlink" href="#import-css-bundles" title="Permanent link">&para;</a></h3>
<p>We created pre-built CSS bundles to be used for some components due to
their frequency of use. This method only requires an import into the
HTML template. Since it's a separate CSS bundle, we don't need to import
that component in the respective page CSS. The CSS bundle import only
works for the following components:</p>
<ul>
<li>Split</li>
<li>Card</li>
<li>Picto</li>
<li>Callout</li>
<li>Article</li>
<li>Newsletter form</li>
<li>Emphasis box</li>
</ul>
<p>Include a CSS bundle in the template's <code>page_css</code> block along with any
other page-specific bundles, like so:</p>
<div class="highlight"><pre><span></span><code>{% block page_css %}
    {{ css_bundle(&#39;protocol-split&#39;) }}
    {{ css_bundle(&#39;protocol-card&#39;) }}
    {{ css_bundle(&#39;page-specific-bundle&#39;) }}
{% endblock %}
</code></pre></div>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.instant.progress", "navigation.tracking", "navigation.top", "toc.follow"], "search": "../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.220ee61c.min.js"></script>
      
    
  </body>
</html>